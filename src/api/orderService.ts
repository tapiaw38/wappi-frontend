import { apiClient } from './client'
import type { Order, CreateOrderInput, UpdateStatusInput, ClaimOrderResponse, MyOrdersResponse, OrderData } from '../types/order'

export interface UpdateOrderInput {
  status?: string
  status_message?: string
  eta?: string
  data?: OrderData
}

export const orderService = {
  async getOrder(id: string): Promise<Order> {
    const response = await apiClient.get<{ data: Order }>(`/api/orders/${id}`)
    return response.data.data
  },

  async createOrder(input: CreateOrderInput): Promise<Order> {
    const { data } = await apiClient.post<Order>('/api/orders', input)
    return data
  },

  async updateStatus(id: string, input: UpdateStatusInput): Promise<Order> {
    const { data } = await apiClient.patch<Order>(`/api/orders/${id}/status`, input)
    return data
  },

  async claimOrder(token: string, securityCode?: string): Promise<ClaimOrderResponse> {
    const { data } = await apiClient.post<ClaimOrderResponse>(`/api/orders/claim/${token}`, {
      security_code: securityCode
    })
    return data
  },

  async getClaimInfo(token: string): Promise<{ order_id: string; user_id: string | null; profile_id: string | null; status: string; is_claimed: boolean }> {
    const { data } = await apiClient.get(`/api/orders/claim/${token}/info`)
    return data
  },

  async getMyOrders(): Promise<MyOrdersResponse> {
    const { data } = await apiClient.get<MyOrdersResponse>('/api/orders/my')
    return data
  },

  async updateOrder(id: string, input: UpdateOrderInput): Promise<Order> {
    const { data } = await apiClient.put<Order>(`/api/admin/orders/${id}`, input)
    return data
  }
}
